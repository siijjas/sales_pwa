var q=Object.defineProperty,z=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var C=(c,a,n)=>a in c?q(c,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[a]=n,S=(c,a)=>{for(var n in a||(a={}))T.call(a,n)&&C(c,n,a[n]);if(D)for(var n of D(a))U.call(a,n)&&C(c,n,a[n]);return c},M=(c,a)=>z(c,J(a));var B=(c,a,n)=>new Promise((i,g)=>{var b=v=>{try{p(n.next(v))}catch(m){g(m)}},l=v=>{try{p(n.throw(v))}catch(m){g(m)}},p=v=>v.done?i(v.value):Promise.resolve(v.value).then(b,l);p((n=n.apply(c,a)).next())});import{d as W,u as Y,c as x,r as w,a as A,o as G,z as H,w as K,h as d,i as t,t as r,k as Q,v as X,j as f,F as L,l as F,n as N,s as Z,y as u}from"./index-F6P-OJyq.js";const ee={class:"flex flex-col h-full bg-gray-50"},te={class:"px-4 py-3 bg-white border-b sticky top-0 z-10"},se={class:"flex items-center justify-between gap-2 mb-2"},oe={class:"flex items-center gap-2"},ae={class:"flex items-center gap-3"},ne={class:"mb-2"},re={class:"text-sm font-bold text-gray-900"},le={class:"flex-1 overflow-y-auto"},ie={key:0,class:"px-4 pt-4"},de={class:"bg-white rounded-xl border border-gray-200 px-4 py-2.5 shadow-sm"},ue={class:"text-base font-bold text-gray-900"},ce={key:1,class:"px-4 pt-3"},pe={class:"grid grid-cols-2 gap-2"},ve={class:"bg-white rounded-xl border border-gray-200 px-4 py-2.5 shadow-sm"},ge={class:"text-base font-bold text-red-600"},xe={class:"bg-white rounded-xl border border-gray-200 px-4 py-2.5 shadow-sm"},be={class:"text-base font-bold text-green-600"},me={key:2,class:"px-4 pt-4 space-y-2"},he={key:3,class:"px-4 pt-10 text-center"},ye={key:4,class:"px-4 pt-3"},fe={class:"text-[10px] font-bold text-gray-400 uppercase mb-2 px-1"},_e={class:"bg-white rounded-xl border border-gray-200 overflow-hidden divide-y divide-gray-100"},we={key:0,class:"text-sm"},ke={key:1,class:"text-sm"},De={class:"flex-1 min-w-0"},Ce={class:"flex justify-between items-start"},Se={class:"min-w-0 pr-2"},Me={class:"text-sm font-medium text-gray-900 truncate"},Be={class:"text-[10px] text-gray-400"},Le={class:"text-right shrink-0"},Fe={class:"text-[10px] text-gray-400 tabular-nums"},Ne={key:5,class:"px-4 pt-3 pb-20"},Pe={class:"bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-xl px-4 py-4 shadow-lg"},Re={class:"text-2xl font-bold mt-1"},Ie=W({__name:"CustomerLedgerView",setup(c){const a=Y(),n=A();Z();const i=x(()=>a.customer),g=x(()=>a.currencyDisplay),b=w("week"),l=w([]),p=w(!1),v=x(()=>{const s=new Date,e=new Date;switch(b.value){case"week":e.setDate(e.getDate()-7);break;case"month":e.setMonth(e.getMonth()-1);break;case"3months":e.setMonth(e.getMonth()-3);break;case"6months":e.setMonth(e.getMonth()-6);break}return{from:e.toISOString().slice(0,10),to:s.toISOString().slice(0,10)}}),m=n.query.customer,k=n.query.customer_name,h=x(()=>{let s=0;return l.value.map(e=>(s+=e.debit-e.credit,M(S({},e),{balance:s})))}),P=x(()=>l.value.length===0?0:l.value.reduce((s,e)=>s+e.debit-e.credit,0)),R=x(()=>(h.value.length===0,0));x(()=>h.value.length===0?0:h.value[h.value.length-1].balance);const $=x(()=>l.value.reduce((s,e)=>s+e.debit,0)),j=x(()=>l.value.reduce((s,e)=>s+e.credit,0)),I=s=>({"Sales Invoice":"Sales Invoice","Payment Entry":"Payment Received","Journal Entry":"Journal Entry","Credit Note":"Credit Note","Debit Note":"Debit Note"})[s.voucher_type]||s.voucher_type,E=s=>{const e=new Date(s),o=new Date,y=new Date(o);return y.setDate(y.getDate()-1),e.toDateString()===o.toDateString()?"Today":e.toDateString()===y.toDateString()?"Yesterday":e.toLocaleDateString("en-US",{month:"short",day:"numeric"})};G(()=>{m&&k&&a.setCustomer({name:m,customer_name:k,customer_group:"",territory:""}),i.value&&_()});const O=()=>{i.value&&_()},_=()=>B(null,null,function*(){if(i.value){p.value=!0;try{l.value=yield H(i.value.name,v.value.from,v.value.to)}catch(s){console.error("Failed to load ledger",s)}finally{p.value=!1}}}),V=()=>{a.setCustomer(null),l.value=[]};return K([i,b],()=>{i.value&&_()}),(s,e)=>(u(),d("div",ee,[t("div",te,[t("div",se,[t("div",oe,[t("button",{class:"text-sm text-gray-600",onClick:e[0]||(e[0]=o=>s.$router.back())},"Back"),e[4]||(e[4]=t("h2",{class:"text-base font-semibold text-gray-900"},"Customer Ledger",-1))]),t("div",ae,[t("button",{class:"text-sm text-gray-600",onClick:e[1]||(e[1]=o=>s.$router.push({name:"dashboard"}))},"Dashboard"),t("button",{class:"text-sm text-blue-600",onClick:O},"Refresh")])]),t("div",ne,[i.value?(u(),d("div",{key:0,class:"bg-blue-50 border border-blue-100 px-3 py-2 rounded-lg flex justify-between items-center",onClick:V},[t("p",re,r(i.value.customer_name),1),e[5]||(e[5]=t("span",{class:"text-xs text-blue-600 font-medium"},"Change",-1))])):(u(),d("button",{key:1,class:"w-full bg-white border border-dashed border-gray-300 rounded-lg py-2 text-sm text-gray-500",onClick:e[2]||(e[2]=o=>s.$router.push({name:"customers",query:{redirect:"ledger"}}))},"+ Select Customer"))]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-[10px] font-semibold text-gray-400 uppercase mb-0.5"},"Period",-1)),Q(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>b.value=o),class:"w-full bg-gray-50 border border-gray-200 rounded px-2 py-1.5 text-xs outline-none focus:ring-1 focus:ring-blue-500"},[...e[6]||(e[6]=[t("option",{value:"week"},"Last Week",-1),t("option",{value:"month"},"Last Month",-1),t("option",{value:"3months"},"Last 3 Months",-1),t("option",{value:"6months"},"Last 6 Months",-1)])],512),[[X,b.value]])])]),t("div",le,[i.value&&!p.value&&l.value.length>0?(u(),d("div",ie,[t("div",de,[e[8]||(e[8]=t("p",{class:"text-[10px] text-gray-400 uppercase"},"Opening Balance",-1)),t("p",ue,r(g.value)+" "+r(R.value.toFixed(2)),1)])])):f("",!0),i.value&&!p.value&&l.value.length>0?(u(),d("div",ce,[t("div",pe,[t("div",ve,[e[9]||(e[9]=t("p",{class:"text-[10px] text-gray-400 uppercase"},"Invoiced",-1)),t("p",ge,r(g.value)+" "+r($.value.toFixed(2)),1)]),t("div",xe,[e[10]||(e[10]=t("p",{class:"text-[10px] text-gray-400 uppercase"},"Received",-1)),t("p",be,r(g.value)+" "+r(j.value.toFixed(2)),1)])])])):f("",!0),p.value?(u(),d("div",me,[(u(),d(L,null,F(6,o=>t("div",{key:o,class:"bg-white h-14 rounded-lg animate-pulse"})),64))])):l.value.length===0&&i.value?(u(),d("div",he,[...e[11]||(e[11]=[t("p",{class:"text-gray-400 text-sm"},"No transactions found for this period.",-1)])])):l.value.length>0?(u(),d("div",ye,[t("p",fe,r(l.value.length)+" Transactions",1),t("div",_e,[(u(!0),d(L,null,F(h.value,(o,y)=>(u(),d("div",{key:y,class:"px-3 py-2.5 flex items-center gap-3"},[t("div",{class:N(["w-8 h-8 rounded-full flex items-center justify-center shrink-0",o.debit>0?"bg-red-50":"bg-green-50"])},[o.debit>0?(u(),d("span",we,"ðŸ“„")):(u(),d("span",ke,"ðŸ’µ"))],2),t("div",De,[t("div",Ce,[t("div",Se,[t("p",Me,r(I(o)),1),t("p",Be,r(E(o.posting_date))+" Â· "+r(o.voucher_no),1)]),t("div",Le,[t("p",{class:N(["text-sm font-bold tabular-nums",o.debit>0?"text-red-600":"text-green-600"])},r(o.debit>0?"+":"-")+" "+r(g.value)+" "+r((o.debit>0?o.debit:o.credit).toFixed(2)),3),t("p",Fe,"Bal: "+r(g.value)+" "+r(Math.abs(o.balance).toFixed(2)),1)])])])]))),128))])])):f("",!0),i.value&&!p.value&&l.value.length>0?(u(),d("div",Ne,[t("div",Pe,[e[12]||(e[12]=t("p",{class:"text-xs opacity-90 uppercase font-semibold"},"Outstanding Balance",-1)),t("p",Re,r(g.value)+" "+r(Math.abs(P.value).toFixed(2)),1)])])):f("",!0)])]))}});export{Ie as default};
//# sourceMappingURL=CustomerLedgerView-DhkeXcyj.js.map
