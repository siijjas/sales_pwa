var le=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var G=(p,d,i)=>d in p?le(p,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[d]=i,H=(p,d)=>{for(var i in d||(d={}))re.call(d,i)&&G(p,i,d[i]);if(Q)for(var i of Q(d))de.call(d,i)&&G(p,i,d[i]);return p},J=(p,d)=>oe(p,ne(d));var w=(p,d,i)=>new Promise(($,c)=>{var x=r=>{try{m(i.next(r))}catch(g){c(g)}},k=r=>{try{m(i.throw(r))}catch(g){c(g)}},m=r=>r.done?$(r.value):Promise.resolve(r.value).then(x,k);m((i=i.apply(p,d)).next())});import{d as ue,u as ie,c as C,r as v,a as ce,o as me,g as ve,b as be,e as pe,f as xe,w as ye,h as l,i as e,j as b,t as n,k as S,v as ge,F as V,l as L,m as I,n as h,p as fe,q as _e,s as he,x as ke,y as o}from"./index-F6P-OJyq.js";const we={class:"flex flex-col h-full bg-gray-50"},Ce={class:"px-4 py-3 bg-white border-b flex items-center gap-2 sticky top-0 z-10 justify-between"},Se={class:"flex items-center gap-2"},Fe={class:"flex items-center gap-3"},Oe={class:"flex-1 overflow-y-auto px-4 py-4 space-y-6 pb-24"},Pe={class:"space-y-2"},Ae={key:0,class:"bg-white p-3 rounded-xl border flex justify-between items-center shadow-sm"},je={class:"font-semibold text-gray-900"},Ie={class:"text-xs text-gray-500"},$e={key:0,class:"space-y-6"},Me={key:0,class:"bg-blue-50 border border-blue-100 rounded-xl p-3 text-sm space-y-2"},Ve={class:"flex justify-between items-center"},Le={class:"font-bold text-blue-900"},Ne={key:0,class:"flex justify-between items-center border-t border-blue-100 pt-2"},Ue={class:"text-right"},qe={class:"font-medium text-blue-900 block"},Be={class:"text-xs text-blue-600 block"},De={key:1,class:"flex justify-between items-center border-t border-blue-100 pt-2"},Ee={class:"text-right"},Te={class:"font-medium text-blue-900 block"},Re={class:"text-xs text-blue-600 block"},ze={class:"space-y-4"},Qe=["value"],Ge={class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},He={class:"space-y-2"},Je={class:"grid grid-cols-3 gap-2"},Ke={class:"text-xs text-gray-500 mt-1"},We={key:0},Xe={key:1},Ye={key:2},Ze={key:1,class:"space-y-2"},et={class:"flex justify-between items-center"},tt={class:"text-xs font-medium text-gray-500"},st={key:0},at={key:1,class:"space-y-2"},lt={key:2,class:"bg-gray-100 rounded-xl p-4 text-center text-sm text-gray-500"},ot={key:3,class:"space-y-2"},nt=["onClick"],rt={class:"flex items-start gap-3"},dt={key:0,class:"pt-1"},ut={key:0,class:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it={class:"flex-1"},ct={class:"flex justify-between items-start mb-2"},mt={class:"font-semibold text-gray-900"},vt={class:"text-xs text-gray-500"},bt={class:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded-lg"},pt={class:"font-medium text-gray-900"},xt={class:"text-right"},yt={class:"font-bold text-blue-600"},gt={key:0,class:"mt-2 pt-2 border-t"},ft={class:"flex items-center justify-between"},_t={class:"flex items-center gap-2"},ht=["onUpdate:modelValue","onInput"],kt={key:1,class:"text-sm font-semibold text-blue-600"},wt={key:2,class:"space-y-3"},Ct={class:"space-y-2"},St={key:0},Ft={key:1,class:"space-y-2"},Ot={key:2,class:"bg-gray-100 rounded-xl p-4 text-center text-sm text-gray-500"},Pt={key:3,class:"space-y-2"},At={class:"flex items-center gap-3"},jt={key:0,class:"w-2 h-2 bg-white rounded-full"},It=["onClick"],$t={class:"flex items-start gap-3"},Mt={class:"pt-1"},Vt={key:0,class:"w-2 h-2 bg-white rounded-full"},Lt={class:"flex-1"},Nt={class:"flex justify-between items-start mb-2"},Ut={class:"font-semibold text-gray-900"},qt={class:"text-xs text-gray-500"},Bt={class:"flex justify-between items-center text-sm bg-gray-50 p-2 rounded-lg"},Dt={class:"font-medium text-gray-900"},Et={class:"text-right"},Tt={class:"font-bold text-blue-600"},Rt={class:"p-4 bg-white border-t sticky bottom-0 z-10 shadow-lg"},zt=["disabled"],Ht=ue({__name:"PaymentEntryView",setup(p){const d=ie(),i=ce(),$=he(),c=C(()=>d.customer),x=C(()=>d.currencyDisplay),k=v(""),m=v(null),r=v([]),g=v([]),y=v(null),F=v([]),M=v(!1),O=v(!1),P=v(!1),u=v("auto"),f=v(null),A=v(""),j=v(""),N=i.query.customer,U=i.query.customer_name;me(()=>w(null,null,function*(){N&&U&&d.setCustomer({name:N,customer_name:U,customer_group:"",territory:""});try{F.value=yield ve(),F.value.length&&(k.value=F.value[0].name)}catch(a){console.error("Failed to load payment modes",a)}c.value&&(q(),B(),D())}));const K=()=>w(null,null,function*(){c.value&&(yield Promise.all([q(),B(),D()]))}),q=()=>w(null,null,function*(){if(c.value){M.value=!0;try{const a=yield be(c.value.name);r.value=a.map(t=>J(H({},t),{checked:!1,allocated_amount:0}))}catch(a){console.error("Failed to load invoices",a)}finally{M.value=!1}}}),B=()=>w(null,null,function*(){if(c.value){O.value=!0;try{g.value=yield pe(c.value.name)}catch(a){console.error("Failed to load sales orders",a)}finally{O.value=!1}}}),D=()=>w(null,null,function*(){if(c.value)try{y.value=yield xe(c.value.name)}catch(a){console.error("Failed to load customer summary",a)}}),W=()=>{d.setCustomer(null),r.value=[],g.value=[],y.value=null,m.value=null,f.value=null},X=()=>{u.value==="auto"&&E()},E=()=>{if(!m.value||m.value<=0){r.value.forEach(s=>{s.checked=!1,s.allocated_amount=0});return}let a=m.value;[...r.value].sort((s,_)=>new Date(s.posting_date).getTime()-new Date(_.posting_date).getTime()).forEach(s=>{if(a<=0)s.checked=!1,s.allocated_amount=0;else{const _=Math.min(a,s.outstanding_amount);s.checked=_>0,s.allocated_amount=_,a-=_}})},Y=a=>{a.checked=!a.checked,a.checked?a.allocated_amount||(a.allocated_amount=a.outstanding_amount):a.allocated_amount=0,T()},Z=a=>{a.allocated_amount&&a.allocated_amount>a.outstanding_amount&&(a.allocated_amount=a.outstanding_amount),a.allocated_amount&&a.allocated_amount<0&&(a.allocated_amount=0),a.allocated_amount===0&&(a.checked=!1),T()},T=()=>{const a=r.value.filter(t=>t.checked).reduce((t,s)=>t+(s.allocated_amount||0),0);m.value=a},ee=C(()=>r.value.filter(a=>a.checked).reduce((a,t)=>a+(t.allocated_amount||0),0)),te=C(()=>{if(!A.value.trim())return r.value;const a=A.value.toLowerCase();return r.value.filter(t=>t.name.toLowerCase().includes(a))}),se=C(()=>{if(!j.value.trim())return g.value;const a=j.value.toLowerCase();return g.value.filter(t=>t.name.toLowerCase().includes(a))}),R=C(()=>(m.value||0)-ee.value),z=C(()=>!c.value||!k.value||(m.value||0)<=0?!1:u.value==="advance"?!0:R.value>=0),ae=()=>w(null,null,function*(){if(!(!z.value||!c.value)){P.value=!0;try{const a=u.value==="advance"?[]:r.value.filter(t=>t.checked&&(t.allocated_amount||0)>0).map(t=>({name:t.name,grand_total:t.grand_total,outstanding_amount:t.outstanding_amount,allocated_amount:t.allocated_amount||0}));yield _e(c.value.name,k.value,m.value||0,a,u.value==="advance"&&f.value||void 0),alert("Payment created successfully!"),$.back()}catch(a){alert(a.message||"Failed to create payment")}finally{P.value=!1}}});return ye(u,a=>{a==="auto"&&m.value?E():a==="advance"&&r.value.forEach(t=>{t.checked=!1,t.allocated_amount=0})}),(a,t)=>(o(),l("div",we,[e("div",Ce,[e("div",Se,[e("button",{class:"text-sm text-gray-600",onClick:t[0]||(t[0]=s=>a.$router.back())},"Back"),t[12]||(t[12]=e("h2",{class:"text-base font-semibold text-gray-900"},"New Payment",-1))]),e("div",Fe,[e("button",{class:"text-sm text-gray-600",onClick:t[1]||(t[1]=s=>a.$router.push({name:"dashboard"}))},"Dashboard"),e("button",{class:"text-sm text-blue-600",onClick:K},"Refresh")])]),e("div",Oe,[e("div",Pe,[t[13]||(t[13]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase"},"Customer",-1)),c.value?(o(),l("div",Ae,[e("div",null,[e("p",je,n(c.value.customer_name),1),e("p",Ie,n(c.value.name),1)]),e("button",{class:"text-blue-600 text-sm font-medium",onClick:W},"Change")])):(o(),l("button",{key:1,class:"w-full bg-white border-2 border-dashed border-gray-300 rounded-xl p-4 text-gray-500 font-medium hover:border-blue-500 hover:text-blue-500 transition-colors",onClick:t[2]||(t[2]=s=>a.$router.push({name:"customers",query:{redirect:"payment"}}))}," + Select Customer "))]),c.value?(o(),l("div",$e,[y.value?(o(),l("div",Me,[e("div",Ve,[t[14]||(t[14]=e("span",{class:"text-blue-800 font-medium"},"Outstanding Balance",-1)),e("span",Le,n(x.value)+" "+n(y.value.outstanding_balance.toFixed(2)),1)]),y.value.last_invoice?(o(),l("div",Ne,[t[15]||(t[15]=e("span",{class:"text-blue-700"},"Last Invoice",-1)),e("div",Ue,[e("span",qe,n(y.value.last_invoice.name),1),e("span",Be,n(y.value.last_invoice.posting_date)+" • "+n(x.value)+" "+n(y.value.last_invoice.grand_total.toFixed(2)),1)])])):b("",!0),y.value.last_payment?(o(),l("div",De,[t[16]||(t[16]=e("span",{class:"text-blue-700"},"Last Payment",-1)),e("div",Ee,[e("span",Te,n(x.value)+" "+n(y.value.last_payment.paid_amount.toFixed(2)),1),e("span",Re,n(y.value.last_payment.posting_date),1)])])):b("",!0)])):b("",!0),e("div",ze,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase mb-1"},"Mode of Payment",-1)),S(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>k.value=s),class:"w-full bg-white border border-gray-200 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm"},[t[17]||(t[17]=e("option",{value:"",disabled:""},"Select Mode",-1)),(o(!0),l(V,null,L(F.value,s=>(o(),l("option",{key:s.name,value:s.name},n(s.name),9,Qe))),128))],512),[[ge,k.value]])]),e("div",null,[e("label",Ge,"Paid Amount ("+n(x.value)+")",1),S(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=s=>m.value=s),onInput:X,class:"w-full bg-white border border-gray-200 rounded-xl px-3 py-2 text-lg font-bold text-gray-900 focus:ring-2 focus:ring-blue-500 outline-none shadow-sm",placeholder:"0.00"},null,544),[[I,m.value,void 0,{number:!0}]])])]),e("div",He,[t[19]||(t[19]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase"},"Allocation Type",-1)),e("div",Je,[e("button",{onClick:t[5]||(t[5]=s=>u.value="auto"),class:h(["px-3 py-2 rounded-lg text-sm font-medium transition-all",u.value==="auto"?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border border-gray-200"])}," Auto (FIFO) ",2),e("button",{onClick:t[6]||(t[6]=s=>u.value="manual"),class:h(["px-3 py-2 rounded-lg text-sm font-medium transition-all",u.value==="manual"?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border border-gray-200"])}," Manual ",2),e("button",{onClick:t[7]||(t[7]=s=>u.value="advance"),class:h(["px-3 py-2 rounded-lg text-sm font-medium transition-all",u.value==="advance"?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 border border-gray-200"])}," Advance ",2)]),e("p",Ke,[u.value==="auto"?(o(),l("span",We,"Automatically allocate to oldest invoices first")):u.value==="manual"?(o(),l("span",Xe,"Manually select and allocate to specific invoices")):(o(),l("span",Ye,"Record as advance payment (not allocated to invoices)"))])]),u.value!=="advance"?(o(),l("div",Ze,[e("div",et,[t[20]||(t[20]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase"},"Outstanding Invoices",-1)),e("span",tt,"Unallocated: "+n(x.value)+" "+n(R.value.toFixed(2)),1)]),u.value==="manual"&&r.value.length>0?(o(),l("div",st,[S(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=s=>A.value=s),placeholder:"Search by invoice number...",class:"w-full bg-white border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm"},null,512),[[I,A.value]])])):b("",!0),M.value?(o(),l("div",at,[...t[21]||(t[21]=[e("div",{class:"h-16 bg-white rounded-xl animate-pulse"},null,-1),e("div",{class:"h-16 bg-white rounded-xl animate-pulse"},null,-1)])])):r.value.length===0?(o(),l("div",lt," No outstanding invoices found. ")):(o(),l("div",ot,[(o(!0),l(V,null,L(te.value,s=>(o(),l("div",{key:s.name,class:h(["bg-white p-3 rounded-xl border border-gray-200 transition-all shadow-sm",s.checked?"border-blue-500 ring-1 ring-blue-500":""]),onClick:_=>u.value==="manual"?Y(s):null},[e("div",rt,[u.value==="manual"?(o(),l("div",dt,[e("div",{class:h(["w-5 h-5 rounded border flex items-center justify-center transition-colors",s.checked?"bg-blue-600 border-blue-600":"border-gray-300"])},[s.checked?(o(),l("svg",ut,[...t[22]||(t[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):b("",!0)],2)])):b("",!0),e("div",it,[e("div",ct,[e("div",null,[e("p",mt,n(s.name),1),e("p",vt,n(s.posting_date),1)])]),e("div",bt,[e("div",null,[t[23]||(t[23]=e("p",{class:"text-[10px] uppercase text-gray-500 font-semibold mb-0.5"},"Invoice Amt",-1)),e("p",pt,n(x.value)+" "+n(s.grand_total.toFixed(2)),1)]),e("div",xt,[t[24]||(t[24]=e("p",{class:"text-[10px] uppercase text-gray-500 font-semibold mb-0.5"},"Pending",-1)),e("p",yt,n(x.value)+" "+n(s.outstanding_amount.toFixed(2)),1)])]),s.checked&&s.allocated_amount>0?(o(),l("div",gt,[e("div",ft,[t[25]||(t[25]=e("label",{class:"text-xs font-medium text-gray-600"},"Allocated",-1)),e("div",_t,[u.value==="manual"?S((o(),l("input",{key:0,type:"number","onUpdate:modelValue":_=>s.allocated_amount=_,class:"w-24 text-right text-sm border rounded px-2 py-1 focus:ring-1 focus:ring-blue-500 outline-none",onClick:t[9]||(t[9]=ke(()=>{},["stop"])),onInput:_=>Z(s)},null,40,ht)),[[I,s.allocated_amount,void 0,{number:!0}]]):(o(),l("span",kt,n(x.value)+" "+n(s.allocated_amount.toFixed(2)),1))])])])):b("",!0)])])],10,nt))),128))]))])):b("",!0),u.value==="advance"?(o(),l("div",wt,[t[31]||(t[31]=fe('<div class="bg-blue-50 border border-blue-200 rounded-xl p-4"><div class="flex items-start gap-3"><div class="text-2xl">ℹ️</div><div><p class="text-sm font-semibold text-blue-900">Advance Payment</p><p class="text-xs text-blue-700 mt-1">Optionally link this payment to a Sales Order, or leave unlinked for general advance payment.</p></div></div></div>',1)),e("div",Ct,[t[30]||(t[30]=e("label",{class:"block text-xs font-semibold text-gray-600 uppercase"},"Link to Sales Order (Optional)",-1)),!O.value&&g.value.length>0?(o(),l("div",St,[S(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=s=>j.value=s),placeholder:"Search by order number...",class:"w-full bg-white border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm"},null,512),[[I,j.value]])])):b("",!0),O.value?(o(),l("div",Ft,[...t[26]||(t[26]=[e("div",{class:"h-16 bg-white rounded-xl animate-pulse"},null,-1),e("div",{class:"h-16 bg-white rounded-xl animate-pulse"},null,-1)])])):g.value.length===0?(o(),l("div",Ot," No sales orders found for this customer. ")):(o(),l("div",Pt,[e("button",{onClick:t[11]||(t[11]=s=>f.value=null),class:h(["w-full bg-white p-3 rounded-xl border transition-all text-left",f.value===null?"border-blue-500 ring-1 ring-blue-500":"border-gray-200"])},[e("div",At,[e("div",{class:h(["w-5 h-5 rounded-full border flex items-center justify-center transition-colors",f.value===null?"bg-blue-600 border-blue-600":"border-gray-300"])},[f.value===null?(o(),l("div",jt)):b("",!0)],2),t[27]||(t[27]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold text-gray-900"},"No Sales Order"),e("p",{class:"text-xs text-gray-500"},"General advance payment")],-1))])],2),(o(!0),l(V,null,L(se.value,s=>(o(),l("div",{key:s.name,onClick:_=>f.value=s.name,class:h(["bg-white p-3 rounded-xl border transition-all cursor-pointer",f.value===s.name?"border-blue-500 ring-1 ring-blue-500":"border-gray-200"])},[e("div",$t,[e("div",Mt,[e("div",{class:h(["w-5 h-5 rounded-full border flex items-center justify-center transition-colors",f.value===s.name?"bg-blue-600 border-blue-600":"border-gray-300"])},[f.value===s.name?(o(),l("div",Vt)):b("",!0)],2)]),e("div",Lt,[e("div",Nt,[e("div",null,[e("p",Ut,n(s.name),1),e("p",qt,n(s.transaction_date),1)])]),e("div",Bt,[e("div",null,[t[28]||(t[28]=e("p",{class:"text-[10px] uppercase text-gray-500 font-semibold mb-0.5"},"Order Amt",-1)),e("p",Dt,n(x.value)+" "+n(s.grand_total.toFixed(2)),1)]),e("div",Et,[t[29]||(t[29]=e("p",{class:"text-[10px] uppercase text-gray-500 font-semibold mb-0.5"},"Pending",-1)),e("p",Tt,n(x.value)+" "+n((s.grand_total-(s.advance_paid||0)).toFixed(2)),1)])])])])],10,It))),128))]))])])):b("",!0)])):b("",!0)]),e("div",Rt,[e("button",{class:"w-full bg-blue-700 text-white rounded-lg py-3 font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-sm active:scale-[0.99] transition-transform",disabled:P.value||!z.value,onClick:ae},n(P.value?"Submitting...":"Create Payment"),9,zt)])]))}});export{Ht as default};
//# sourceMappingURL=PaymentEntryView-z58lLToU.js.map
